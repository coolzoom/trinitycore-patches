From 00b91817006f9e0a0659e8c5944dd020ab5ea7bf Mon Sep 17 00:00:00 2001
From: LordPsyan <realmsofwarcraft@gmail.com>
Date: Thu, 18 Sep 2014 10:45:19 -0400
Subject: [PATCH] NPC_Lottery

---
 .../NPC_Lottery/characters.npc.lottery.sql         |  4 ++
 .../NPC_Lottery/world.npc.lottery.sql              |  9 +++
 src/server/game/Scripting/ScriptLoader.cpp         |  4 +-
 src/server/scripts/Custom/npc_lotto.cpp            | 69 ++++++++++++++++++++++
 4 files changed, 84 insertions(+), 2 deletions(-)
 create mode 100644 sql/TrinityCore-Patches/NPC_Lottery/characters.npc.lottery.sql
 create mode 100644 sql/TrinityCore-Patches/NPC_Lottery/world.npc.lottery.sql
 create mode 100644 src/server/scripts/Custom/npc_lotto.cpp

diff --git a/sql/TrinityCore-Patches/NPC_Lottery/characters.npc.lottery.sql b/sql/TrinityCore-Patches/NPC_Lottery/characters.npc.lottery.sql
new file mode 100644
index 0000000..13705e4
--- /dev/null
+++ b/sql/TrinityCore-Patches/NPC_Lottery/characters.npc.lottery.sql
@@ -0,0 +1,4 @@
+CREATE TABLE `game_lotto` (
+ `entry` TEXT NULL,
+ `comment` TEXT NULL
+);
\ No newline at end of file
diff --git a/sql/TrinityCore-Patches/NPC_Lottery/world.npc.lottery.sql b/sql/TrinityCore-Patches/NPC_Lottery/world.npc.lottery.sql
new file mode 100644
index 0000000..5d6dfe8
--- /dev/null
+++ b/sql/TrinityCore-Patches/NPC_Lottery/world.npc.lottery.sql
@@ -0,0 +1,9 @@
+DELETE FROM creature_template WHERE `entry`=900010;
+
+INSERT INTO `creature_template` (`entry`, `difficulty_entry_1`, `difficulty_entry_2`, `difficulty_entry_3`, `KillCredit1`, `KillCredit2`, `modelid1`, `modelid2`, `modelid3`, `modelid4`, `name`, `subname`, `IconName`, `gossip_menu_id`, `minlevel`, `maxlevel`, `exp`, `faction`, `npcflag`, `speed_walk`, `speed_run`, `scale`, `rank`, `dmgschool`, `BaseAttackTime`, `RangeAttackTime`, `BaseVariance`, `RangeVariance`, `unit_class`, `unit_flags`, `unit_flags2`, `dynamicflags`, `family`, `trainer_type`, `trainer_spell`, `trainer_class`, `trainer_race`, `type`, `type_flags`, `lootid`, `pickpocketloot`, `skinloot`, `resistance1`, `resistance2`, `resistance3`, `resistance4`, `resistance5`, `resistance6`, `spell1`, `spell2`, `spell3`, `spell4`, `spell5`, `spell6`, `spell7`, `spell8`, `PetSpellDataId`, `VehicleId`, `mingold`, `maxgold`, `AIName`, `MovementType`, `InhabitType`, `HoverHeight`, `HealthModifier`, `ManaModifier`, `ArmorModifier`, `DamageModifier`, `ExperienceModifier`, `RacialLeader`, `questItem1`, `questItem2`, `questItem3`, `questItem4`, `questItem5`, `questItem6`, `movementId`, `RegenHealth`, `mechanic_immune_mask`, `flags_extra`, `ScriptName`, `VerifiedBuild`) VALUES
+('900010', '0', '0', '0', '0', '0', '26789', '0', '0', '0', 'Lotty', '- by GoN -', NULL, '0', '80', '80', '0', '35', '1', '1', '1.14286', '0.75', '0', '0', '1400', '1900', '1', '1', '1', '0', '0', '0', '0', '0', '0', '0', '0', '7', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '', '1', '3', '1', '1', '1', '1', '1', '1', '0', '0', '0', '0', '0', '0', '0', '0', '1', '0', '0', 'npc_lotto', '12340');
+
+DELETE FROM `creature_template` WHERE `entry` = 200800;
+
+INSERT INTO `item_template` (`entry`, `class`, `subclass`, `SoundOverrideSubclass`, `name`, `displayid`, `Quality`, `Flags`, `FlagsExtra`, `BuyCount`, `BuyPrice`, `SellPrice`, `InventoryType`, `AllowableClass`, `AllowableRace`, `ItemLevel`, `RequiredLevel`, `RequiredSkill`, `RequiredSkillRank`, `requiredspell`, `requiredhonorrank`, `RequiredCityRank`, `RequiredReputationFaction`, `RequiredReputationRank`, `maxcount`, `stackable`, `ContainerSlots`, `StatsCount`, `stat_type1`, `stat_value1`, `stat_type2`, `stat_value2`, `stat_type3`, `stat_value3`, `stat_type4`, `stat_value4`, `stat_type5`, `stat_value5`, `stat_type6`, `stat_value6`, `stat_type7`, `stat_value7`, `stat_type8`, `stat_value8`, `stat_type9`, `stat_value9`, `stat_type10`, `stat_value10`, `ScalingStatDistribution`, `ScalingStatValue`, `dmg_min1`, `dmg_max1`, `dmg_type1`, `dmg_min2`, `dmg_max2`, `dmg_type2`, `armor`, `holy_res`, `fire_res`, `nature_res`, `frost_res`, `shadow_res`, `arcane_res`, `delay`, `ammo_type`, `RangedModRange`, `spellid_1`, `spelltrigger_1`, `spellcharges_1`, `spellppmRate_1`, `spellcooldown_1`, `spellcategory_1`, `spellcategorycooldown_1`, `spellid_2`, `spelltrigger_2`, `spellcharges_2`, `spellppmRate_2`, `spellcooldown_2`, `spellcategory_2`, `spellcategorycooldown_2`, `spellid_3`, `spelltrigger_3`, `spellcharges_3`, `spellppmRate_3`, `spellcooldown_3`, `spellcategory_3`, `spellcategorycooldown_3`, `spellid_4`, `spelltrigger_4`, `spellcharges_4`, `spellppmRate_4`, `spellcooldown_4`, `spellcategory_4`, `spellcategorycooldown_4`, `spellid_5`, `spelltrigger_5`, `spellcharges_5`, `spellppmRate_5`, `spellcooldown_5`, `spellcategory_5`, `spellcategorycooldown_5`, `bonding`, `description`, `PageText`, `LanguageID`, `PageMaterial`, `startquest`, `lockid`, `Material`, `sheath`, `RandomProperty`, `RandomSuffix`, `block`, `itemset`, `MaxDurability`, `area`, `Map`, `BagFamily`, `TotemCategory`, `socketColor_1`, `socketContent_1`, `socketColor_2`, `socketContent_2`, `socketColor_3`, `socketContent_3`, `socketBonus`, `GemProperties`, `RequiredDisenchantSkill`, `ArmorDamageModifier`, `duration`, `ItemLimitCategory`, `HolidayId`, `ScriptName`, `DisenchantID`, `FoodType`, `minMoneyLoot`, `maxMoneyLoot`, `flagsCustom`, `VerifiedBuild`) VALUES
+('200800','12','0','-1','Lottery Ticket','46679','2','0','0','1','0','0','0','-1','-1','1','0','0','0','0','0','0','0','0','0','200','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','2000','0','-1','0','0','0','0','-1','0','-1','0','0','0','0','-1','0','-1','0','0','0','0','-1','0','-1','0','0','0','0','-1','0','-1','1','','0','0','0','0','0','7','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','-1','0','0','0','0','','0','0','0','0','0','12340');
diff --git a/src/server/game/Scripting/ScriptLoader.cpp b/src/server/game/Scripting/ScriptLoader.cpp
index 5d120b2..942c2f4 100644
--- a/src/server/game/Scripting/ScriptLoader.cpp
+++ b/src/server/game/Scripting/ScriptLoader.cpp
@@ -1512,7 +1512,7 @@ void AddBattlegroundScripts()
 // start76
 // start77
 // start78
-// start79
+void AddSC_npc_lotto();
 // start80
 #endif
 
@@ -1598,7 +1598,7 @@ void AddCustomScripts()
 // end76
 // end77
 // end78
-// end79
+    AddSC_npc_lotto();
 // end80
 #endif
 }
diff --git a/src/server/scripts/Custom/npc_lotto.cpp b/src/server/scripts/Custom/npc_lotto.cpp
new file mode 100644
index 0000000..113c818
--- /dev/null
+++ b/src/server/scripts/Custom/npc_lotto.cpp
@@ -0,0 +1,69 @@
+/*
+  _____                        ____
+ |  ___| __ ___ _______ _ __  / ___|___  _ __ ___
+ | |_ | '__/ _ \_  / _ \ '_ \| |   / _ \| '__/ _ \
+ |  _|| | | (_) / /  __/ | | | |__| (_) | | |  __/
+ |_|  |_|  \___/___\___|_| |_|\____\___/|_|  \___|
+     Lightning speed and strength
+         conjured directly from the depths of logic!
+            Infusion-WoW 2011 - 2012 (C)
+<--------------------------------------------------------------------------->
+ - Developer(s): N/A
+ - Complete: N/A
+ - ScriptName: ''
+ - Comment: N/A
+<--------------------------------------------------------------------------->
+*/
+//test
+#include "ScriptPCH.h"
+#include <cstring>
+
+enum eEnums
+{
+    ITEM_LOTTO   = 200800,
+
+};
+
+class npc_lotto : public CreatureScript
+{
+    public:
+        npc_lotto() : CreatureScript("npc_lotto") { }
+
+        bool OnGossipHello(Player* player, Creature* creature)
+        {
+            if (player->HasItemCount(ITEM_LOTTO, 1, false))
+            {
+                player->ADD_GOSSIP_ITEM(GOSSIP_ICON_CHAT, "The stars say i'll be looking, i fancy my chances in the lottery this week.", GOSSIP_SENDER_MAIN, GOSSIP_ACTION_INFO_DEF+1);
+            }
+            else
+                creature->Whisper("You dont have enough Lottery Tickets", LANG_UNIVERSAL, player);
+
+            player->PlayerTalkClass->SendGossipMenu(DEFAULT_GOSSIP_MESSAGE, creature->GetGUID());
+            return true;
+        };
+
+        bool OnGossipSelect(Player* player, Creature* creature, uint32 sender, uint32 action)
+        {
+
+            player->PlayerTalkClass->ClearMenus();
+            player->CLOSE_GOSSIP_MENU();
+        switch (action)
+            {
+            case GOSSIP_ACTION_INFO_DEF+1:
+                creature->Whisper("Greetings competitor! Thank you for purchasing your Lottery ticket, please be sure to check your numbers against our database, for your chance to win a stunning 200 gold coins!", LANG_UNIVERSAL, player);
+                WorldDatabase.PExecute("INSERT INTO game_lotto (entry, comment) values (%u,0)", player->GetGUIDLow());
+                player->DestroyItemCount(ITEM_LOTTO, 1, true, false);
+                break;
+            }
+
+            player->CLOSE_GOSSIP_MENU();
+            return true;
+        }
+
+
+};
+
+void AddSC_npc_lotto()
+{
+    new npc_lotto();
+}
-- 
2.1.0

