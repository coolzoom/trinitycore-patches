From c4d0c82199697ac459c028803a95de7a71b43ddc Mon Sep 17 00:00:00 2001
From: LordPsyan <realmsofwarcraft@gmail.com>
Date: Thu, 18 Sep 2014 10:20:58 -0400
Subject: [PATCH] NPC_Lottery

---
 .../NPC_Lottery/characters.npc.lottery.sql         |  4 ++
 src/server/game/Scripting/ScriptLoader.cpp         |  4 +-
 src/server/scripts/Custom/npc_lotto.cpp            | 69 ++++++++++++++++++++++
 3 files changed, 75 insertions(+), 2 deletions(-)
 create mode 100644 sql/TrinityCore-Patches/NPC_Lottery/characters.npc.lottery.sql
 create mode 100644 src/server/scripts/Custom/npc_lotto.cpp

diff --git a/sql/TrinityCore-Patches/NPC_Lottery/characters.npc.lottery.sql b/sql/TrinityCore-Patches/NPC_Lottery/characters.npc.lottery.sql
new file mode 100644
index 0000000..13705e4
--- /dev/null
+++ b/sql/TrinityCore-Patches/NPC_Lottery/characters.npc.lottery.sql
@@ -0,0 +1,4 @@
+CREATE TABLE `game_lotto` (
+ `entry` TEXT NULL,
+ `comment` TEXT NULL
+);
\ No newline at end of file
diff --git a/src/server/game/Scripting/ScriptLoader.cpp b/src/server/game/Scripting/ScriptLoader.cpp
index 5d120b2..942c2f4 100644
--- a/src/server/game/Scripting/ScriptLoader.cpp
+++ b/src/server/game/Scripting/ScriptLoader.cpp
@@ -1512,7 +1512,7 @@ void AddBattlegroundScripts()
 // start76
 // start77
 // start78
-// start79
+void AddSC_npc_lotto();
 // start80
 #endif
 
@@ -1598,7 +1598,7 @@ void AddCustomScripts()
 // end76
 // end77
 // end78
-// end79
+    AddSC_npc_lotto();
 // end80
 #endif
 }
diff --git a/src/server/scripts/Custom/npc_lotto.cpp b/src/server/scripts/Custom/npc_lotto.cpp
new file mode 100644
index 0000000..21d1ba6
--- /dev/null
+++ b/src/server/scripts/Custom/npc_lotto.cpp
@@ -0,0 +1,69 @@
+/*
+  _____                        ____               
+ |  ___| __ ___ _______ _ __  / ___|___  _ __ ___ 
+ | |_ | '__/ _ \_  / _ \ '_ \| |   / _ \| '__/ _ \
+ |  _|| | | (_) / /  __/ | | | |__| (_) | | |  __/
+ |_|  |_|  \___/___\___|_| |_|\____\___/|_|  \___|
+	 Lightning speed and strength
+		 conjured directly from the depths of logic!   
+			Infusion-WoW 2011 - 2012 (C)
+<--------------------------------------------------------------------------->
+ - Developer(s): N/A
+ - Complete: N/A
+ - ScriptName: '' 
+ - Comment: N/A
+<--------------------------------------------------------------------------->
+*/
+//test
+#include "ScriptPCH.h"
+#include <cstring>
+
+enum eEnums
+{
+	ITEM_LOTTO   = 200800,
+	
+};
+
+class npc_lotto : public CreatureScript
+{
+    public:
+        npc_lotto() : CreatureScript("npc_lotto") { }
+
+        bool OnGossipHello(Player* player, Creature* creature)
+        {
+			if (player->HasItemCount(ITEM_LOTTO, 1, false))
+			{
+				player->ADD_GOSSIP_ITEM(GOSSIP_ICON_CHAT, "The stars say i'll be looking, i fancy my chances in the lottery this week.", GOSSIP_SENDER_MAIN, GOSSIP_ACTION_INFO_DEF+1);
+			}
+			else
+				creature->Whisper("You dont have enough Lottery Tickets", LANG_UNIVERSAL, player);
+
+			player->PlayerTalkClass->SendGossipMenu(DEFAULT_GOSSIP_MESSAGE, creature->GetGUID());
+            return true;
+		};
+
+		bool OnGossipSelect(Player* player, Creature* creature, uint32 sender, uint32 action)
+		{
+			
+            player->PlayerTalkClass->ClearMenus();
+            player->CLOSE_GOSSIP_MENU();
+        switch (action)
+            {
+		    case GOSSIP_ACTION_INFO_DEF+1:
+			    creature->Whisper("Greetings competitor! Thank you for purchasing your Lottery ticket, please be sure to check your numbers against our database, for your chance to win a stunning 200 gold coins!", LANG_UNIVERSAL, player);
+				WorldDatabase.PExecute("INSERT INTO game_lotto (entry, comment) values (%u,0)", player->GetGUIDLow());
+				player->DestroyItemCount(ITEM_LOTTO, 1, true, false);
+				break;
+		    }
+
+			player->CLOSE_GOSSIP_MENU();
+			return true;
+	    }
+
+
+};
+
+void AddSC_npc_lotto()
+{
+	new npc_lotto();
+}
-- 
2.1.0

